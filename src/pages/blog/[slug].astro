---
import Layout from '../../layouts/Layout.astro';
import fetchApi from '../../lib/strapi';
import type Article from '../../interfaces/article';

export async function getStaticPaths() {
    const articles = await fetchApi<Article[]>({
        endpoint: 'articles?populate=image',
        wrappedByKey: 'data',
    });

    return articles.map((article) => ({
        params: { slug: article.slug },
        props: article,
    }));
}
type Props = Article;

const article = Astro.props;

const STRAPI_API_URL = import.meta.env.STRAPI_URL;
---

<Layout title={article.title}>
    <section>
        <div class="container px-4 md:px-32 my-64 mx-auto text-gray-300 font-mono fix-margin">
            {
                article.image && (
                    <div class="mb-8 mt-16">
                        <img
                            src={`${STRAPI_API_URL}${article.image.url}`}
                            alt={article.image.alternativeText || article.title}
                            class="w-auto h-auto object-cover rounded-lg"
                        />
                    </div>
                )
            }
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-2">{article.title}</h1>
            <p class="text-sm text-gray-500 mb-8">
                Published on: {new Date(article.publish_date).toLocaleDateString('vi-VN')}
            </p>

            <div class="prose prose-invert max-w-none">
                <Fragment set:html={article.content} />
            </div>
        </div>
    </section>
</Layout>

<style>
    .prose-invert h1,
    .prose-invert h2,
    .prose-invert h3 {
        color: #fff;
        font-weight: bold;
        margin-top: 1.5rem;
        margin-bottom: 0.5rem;
    }

    .prose-invert p {
        color: #ccc;
        line-height: 1.7;
        margin-bottom: 1rem;
    }

    .prose-invert a {
        color: #a855f7;
        text-decoration: underline;
    }

    .fix-margin {
        margin-top: 7rem !important;
    }
</style>
