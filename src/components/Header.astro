---
const { translations, currentLang } = Astro.props;
---

<svg style="position: absolute; width: 0; height: 0;" aria-hidden="true">
    <defs>
        <linearGradient id="shared-grad" x1="0%" y1="0%" x2="100%" y2="100%" gradientTransform="rotate(135)">
            <stop offset="0%" stop-color="#a855f7"></stop>
            <stop offset="100%" stop-color="#ec4899"></stop>
        </linearGradient>
    </defs>
</svg>
<header
    id="main-header"
    class="header-backdrop sticky top-0 left-0 w-full z-50 bg-black/30 border-b border-gradient/20 font-mono"
>
    <div class="max-w-7xl mx-auto">
        <div class="flex items-center justify-between h-16">
            <!-- Logo -->
            <a href={`/${currentLang}`} class="flex items-center font-mono text-white">
                <span class="gradient-text text-lg">$</span>
                <span class="ml-1 text-lg pr-4 hover:scale-105 origin-left transition-transform duration-500"
                    >jokholk@portfolio</span
                >
            </a>
            <!-- Desktop Navigation (1536px+) -->
            <nav class="hidden 2xl:flex items-center space-x-1">
                <a
                    href={`/${currentLang}#home`}
                    class="nav-link flex items-center space-x-2 px-3 py-2 rounded-lg text-sm hover:bg-gradient/10 transition-all duration-300"
                    data-scroll-target="home"
                >
                    <svg class="w-4 h-4 nav-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                        ></path>
                    </svg>
                    <span class="nav-span">{translations?.header?.home}</span>
                </a>
                <a
                    href={`/${currentLang}#about`}
                    class="nav-link flex items-center space-x-2 px-3 py-2 rounded-lg text-sm hover:bg-gradient/10 transition-all duration-300"
                    data-scroll-target="about"
                >
                    <svg class="w-4 h-4 nav-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <span class="nav-span">{translations?.header?.about}</span>
                </a>
                <a
                    href={`/${currentLang}#education`}
                    class="nav-link flex items-center space-x-2 px-3 py-2 rounded-lg text-sm hover:bg-gradient/10 transition-all duration-300"
                    data-scroll-target="education"
                >
                    <svg class="w-4 h-4 nav-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 14l9-5-9-5-9 5 9 5z"></path>
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"
                        ></path>
                    </svg>
                    <span class="nav-span">{translations?.header?.education}</span>
                </a>
                <a
                    href={`/${currentLang}#experience`}
                    class="nav-link flex items-center space-x-2 px-3 py-2 rounded-lg text-sm hover:bg-gradient/10 transition-all duration-300"
                    data-scroll-target="experience"
                >
                    <svg class="w-4 h-4 nav-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M20.25 14.15v4.25c0 1.094-.787 2.036-1.872 2.18-2.087.277-4.216.42-6.378.42s-4.291-.143-6.378-.42c-1.085-.144-1.872-1.086-1.872-2.18v-4.25m16.5 0a2.18 2.18 0 0 0 .75-1.661V8.706c0-1.081-.768-2.015-1.837-2.175a48.114 48.114 0 0 0-3.413-.387m4.5 8.006c-.194.165-.42.295-.673.38A23.978 23.978 0 0 1 12 15.75c-2.648 0-5.195-.429-7.577-1.22a2.016 2.016 0 0 1-.673-.38m0 0A2.18 2.18 0 0 1 3 12.489V8.706c0-1.081.768-2.015 1.837-2.175a48.111 48.111 0 0 1 3.413-.387m7.5 0V5.25A2.25 2.25 0 0 0 13.5 3h-3a2.25 2.25 0 0 0-2.25 2.25v.894m7.5 0a48.667 48.667 0 0 0-7.5 0M12 12.75h.008v.008H12v-.008Z"
                        ></path>
                    </svg>
                    <span class="nav-span">{translations?.header?.experience}</span>
                </a>
                <a
                    href={`/${currentLang}#projects`}
                    class="nav-link flex items-center space-x-2 px-3 py-2 rounded-lg text-sm hover:bg-gradient/10 transition-all duration-300"
                    data-scroll-target="projects"
                >
                    <svg class="w-4 h-4 nav-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                    </svg>
                    <span class="nav-span">{translations?.header?.projects}</span>
                </a>
                <a
                    href={`/${currentLang}#blogs`}
                    class="nav-link flex items-center space-x-2 px-3 py-2 rounded-lg text-sm hover:bg-gradient/10 transition-all duration-300"
                    data-scroll-target="blogs"
                >
                    <svg class="w-4 h-4 nav-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                        ></path>
                    </svg>
                    <span class="nav-span">{translations?.header?.blogs}</span>
                </a>
                <a
                    href={`/${currentLang}#portfolio`}
                    class="nav-link flex items-center space-x-2 px-3 py-2 rounded-lg text-sm hover:bg-gradient/10 transition-all duration-300"
                    data-scroll-target="portfolio"
                >
                    <svg class="w-4 h-4 nav-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
                        ></path>
                    </svg>
                    <span class="nav-span">{translations?.header?.portfolios}</span>
                </a>
                <a
                    href={`/${currentLang}#contact`}
                    class="nav-link flex items-center space-x-2 px-3 py-2 rounded-lg text-sm hover:bg-gradient/10 transition-all duration-300"
                    data-scroll-target="contact"
                >
                    <svg class="w-4 h-4 nav-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                        ></path>
                    </svg>
                    <span class="nav-span">{translations?.header?.contact}</span>
                </a>
            </nav>
            <!-- Right Side Controls -->
            <div class="flex items-center space-x-4">
                <!-- Language Selector -->
                <div class="relative">
                    <button
                        id="language-button"
                        class="flex items-center space-x-2 px-3 py-2 rounded-lg text-sm hover:bg-gradient/10 transition-all duration-300 font-mono"
                        aria-expanded="false"
                    >
                        <div id="current-flag" class="w-5 h-5 rounded-full overflow-hidden">
                            <svg viewBox="0 0 512 512" class="w-full h-full">
                                <g fill-rule="evenodd">
                                    <g stroke-width="1pt">
                                        <path
                                            fill="#bd3d44"
                                            d="M0 0h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0z"
                                            transform="scale(3.9385)"></path>
                                        <path
                                            fill="#fff"
                                            d="M0 10h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0z"
                                            transform="scale(3.9385)"></path>
                                    </g>
                                    <path fill="#192f5d" d="M0 0h98.8v70H0z" transform="scale(3.9385)"></path>
                                    <path
                                        fill="#fff"
                                        d="M8.2 3l1 2.8H12L9.7 7.5l.9 2.7-2.4-1.7L6 10.2l.9-2.7-2.4-1.7h3z"></path>
                                </g>
                            </svg>
                        </div>
                        <span id="current-lang">EN</span>
                        <svg
                            class="w-4 h-4 transition-transform duration-300"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"
                            ></path>
                        </svg>
                    </button>
                    <div
                        id="language-dropdown"
                        class="language-dropdown absolute right-0 mt-2 w-36 bg-black/90 backdrop-blur-xl border border-gradient/30 rounded-xl shadow-xl"
                    >
                        <div class="py-2">
                            <a
                                href="#"
                                class="flex items-center space-x-3 px-4 py-2 text-sm hover:bg-gradient/20 transition-colors duration-200"
                                data-lang="en"
                            >
                                <div class="w-4 h-4 rounded-full overflow-hidden">
                                    <svg viewBox="0 0 512 512" class="w-full h-full">
                                        <g fill-rule="evenodd">
                                            <g stroke-width="1pt">
                                                <path
                                                    fill="#bd3d44"
                                                    d="M0 0h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0z"
                                                    transform="scale(3.9385)"></path>
                                                <path
                                                    fill="#fff"
                                                    d="M0 10h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0zm0 20h247v10H0z"
                                                    transform="scale(3.9385)"></path>
                                            </g>
                                            <path fill="#192f5d" d="M0 0h98.8v70H0z" transform="scale(3.9385)"></path>
                                            <path
                                                fill="#fff"
                                                d="M8.2 3l1 2.8H12L9.7 7.5l.9 2.7-2.4-1.7L6 10.2l.9-2.7-2.4-1.7h3z"
                                            ></path>
                                        </g>
                                    </svg>
                                </div>
                                <span>EN</span>
                            </a>
                            <a
                                href="#"
                                class="flex items-center space-x-3 px-4 py-2 text-sm hover:bg-gradient/20 transition-colors duration-200"
                                data-lang="vi"
                            >
                                <div class="w-4 h-4 rounded-full overflow-hidden">
                                    <svg viewBox="0 0 512 512" class="w-full h-full">
                                        <path fill="#DA251D" d="M0 0h512v512H0z"></path>
                                        <path
                                            fill="#FFFE00"
                                            d="m256 331.4-98.2 64.1 36.6-114.8-98.2-64.1 121.6-1.5L256 128l38.2 113.1 121.6 1.5-98.2 64.1 36.6 114.8z"
                                        ></path>
                                    </svg>
                                </div>
                                <span>VI</span>
                            </a>
                        </div>
                    </div>
                </div>
                <!-- Mobile Menu Toggle (1535px and below) -->
                <button
                    id="mobile-menu-toggle"
                    class="2xl:hidden flex flex-col items-center justify-center w-8 h-8 rounded-lg hover:bg-gradient/10 transition-colors duration-300"
                    aria-expanded="false"
                    aria-label="Toggle navigation"
                >
                    <div class="hamburger">
                        <span class="hamburger-line block w-5 h-0.5 bg-gradient mb-1 rounded-full"></span>
                        <span class="hamburger-line block w-5 h-0.5 bg-gradient mb-1 rounded-full"></span>
                        <span class="hamburger-line block w-5 h-0.5 bg-gradient rounded-full"></span>
                    </div>
                </button>
            </div>
        </div>
        <!-- Mobile Navigation Menu (1535px and below) -->
        <div
            id="mobile-menu"
            class="mobile-menu 2xl:hidden bg-black/95 backdrop-blur-xl border-t border-gradient/30 rounded-b-xl"
        >
            <nav class="px-4 py-4">
                <div class="space-y-2">
                    <a
                        href={`/${currentLang}#home`}
                        class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gradient/20 transition-all duration-300"
                        data-scroll-target="home"
                    >
                        <svg class="w-5 h-5 nav-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                            ></path>
                        </svg>
                        <span class="nav-span">{translations?.header?.home}</span>
                    </a>
                    <a
                        href={`/${currentLang}#about`}
                        class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gradient/20 transition-all duration-300"
                        data-scroll-target="about"
                    >
                        <svg class="w-5 h-5 nav-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span class="nav-span">{translations?.header?.about}</span>
                    </a>
                    <a
                        href={`/${currentLang}#education`}
                        class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gradient/20 transition-all duration-300"
                        data-scroll-target="education"
                    >
                        <svg class="w-5 h-5 nav-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.62 48.62 0 0 1 12 20.904a48.62 48.62 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.636 50.636 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.903 59.903 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.717 50.717 0 0 1 12 13.489a50.702 50.702 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0 0v-3.675A55.378 55.378 0 0 1 12 8.443m-7.007 11.55A5.981 5.981 0 0 0 6.75 15.75v-1.5"
                            ></path>
                        </svg>
                        <span class="nav-span">{translations?.header?.education}</span>
                    </a>
                    <a
                        href={`/${currentLang}#experience`}
                        class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gradient/20 transition-all duration-300"
                        data-scroll-target="experience"
                    >
                        <svg class="w-5 h-5 nav-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M20.25 14.15v4.25c0 1.094-.787 2.036-1.872 2.18-2.087.277-4.216.42-6.378.42s-4.291-.143-6.378-.42c-1.085-.144-1.872-1.086-1.872-2.18v-4.25m16.5 0a2.18 2.18 0 0 0 .75-1.661V8.706c0-1.081-.768-2.015-1.837-2.175a48.114 48.114 0 0 0-3.413-.387m4.5 8.006c-.194.165-.42.295-.673.38A23.978 23.978 0 0 1 12 15.75c-2.648 0-5.195-.429-7.577-1.22a2.016 2.016 0 0 1-.673-.38m0 0A2.18 2.18 0 0 1 3 12.489V8.706c0-1.081.768-2.015 1.837-2.175a48.111 48.111 0 0 1 3.413-.387m7.5 0V5.25A2.25 2.25 0 0 0 13.5 3h-3a2.25 2.25 0 0 0-2.25 2.25v.894m7.5 0a48.667 48.667 0 0 0-7.5 0M12 12.75h.008v.008H12v-.008Z"
                            ></path>
                        </svg>
                        <span class="nav-span">{translations?.header?.experience}</span>
                    </a>
                    <a
                        href={`/${currentLang}#projects`}
                        class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gradient/20 transition-all duration-300"
                        data-scroll-target="projects"
                    >
                        <svg class="w-5 h-5 nav-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                        </svg>
                        <span class="nav-span">{translations?.header?.projects}</span>
                    </a>
                    <a
                        href={`/${currentLang}#blogs`}
                        class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gradient/20 transition-all duration-300"
                        data-scroll-target="blogs"
                    >
                        <svg class="w-5 h-5 nav-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                            ></path>
                        </svg>
                        <span class="nav-span">{translations?.header?.blogs}</span>
                    </a>
                    <a
                        href={`/${currentLang}#portfolio`}
                        class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gradient/20 transition-all duration-300"
                        data-scroll-target="portfolio"
                    >
                        <svg class="w-5 h-5 nav-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
                            ></path>
                        </svg>
                        <span class="nav-span">{translations?.header?.portfolios}</span>
                    </a>
                    <a
                        href={`/${currentLang}#contact`}
                        class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gradient/20 transition-all duration-300"
                        data-scroll-target="contact"
                    >
                        <svg class="w-5 h-5 nav-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                            ></path>
                        </svg>
                        <span class="nav-span">{translations?.header?.contact}</span>
                    </a>
                </div>
            </nav>
        </div>
    </div>
</header>
<script>
    declare global {
        interface Window {
            tailwind: any;
        }
    }
    document.addEventListener('DOMContentLoaded', () => {
        const headerEl = document.getElementById('main-header') as HTMLElement | null;
        const mobileMenuToggleEl = document.getElementById('mobile-menu-toggle') as HTMLElement | null;
        const mobileMenuEl = document.getElementById('mobile-menu') as HTMLElement | null;
        const languageButtonEl = document.getElementById('language-button') as HTMLElement | null;
        const languageDropdownEl = document.getElementById('language-dropdown') as HTMLElement | null;
        const navLinks = document.querySelectorAll<HTMLElement>('.nav-link');
        if (!headerEl || !mobileMenuToggleEl || !mobileMenuEl || !languageButtonEl || !languageDropdownEl) {
            console.error('Required DOM elements not found');
            return;
        }
        const header = headerEl!;
        const mobileMenuToggle = mobileMenuToggleEl!;
        const mobileMenu = mobileMenuEl!;
        const languageButton = languageButtonEl!;
        const languageDropdown = languageDropdownEl!;
        // Get current language from URL
        function getCurrentLang(): string {
            const pathSegments = window.location.pathname.split('/').filter((segment) => segment);
            const lang = pathSegments[0];
            return ['en', 'vi'].includes(lang) ? lang : 'en';
        }
        function easeInOutCubic(t: number, b: number, c: number, d: number): number {
            t /= d / 2;
            if (t < 1) return (c / 2) * t * t * t + b;
            t -= 2;
            return (c / 2) * (t * t * t + 2) + b;
        }
        function smoothScrollTo(targetId: string, duration = 1000): void {
            const targetEl = document.getElementById(targetId);
            if (!targetEl) return;
            const startY = window.pageYOffset;
            const endY = targetEl.getBoundingClientRect().top + startY - 80;
            const distance = endY - startY;
            let startTime: number | null = null;
            function step(currentTime: number) {
                if (startTime === null) startTime = currentTime;
                const elapsed = currentTime - startTime;
                const nextY = easeInOutCubic(elapsed, startY, distance, duration);
                window.scrollTo(0, nextY);
                if (elapsed < duration) {
                    requestAnimationFrame(step);
                }
            }
            requestAnimationFrame(step);
        }
        function updateHeaderOnScroll(): void {
            const scrolled = window.scrollY > 50;
            header.classList.toggle('header-scrolled', scrolled);
        }
        function toggleMobileMenu(): void {
            const isOpen = mobileMenuToggle.getAttribute('aria-expanded') === 'true';
            const nextState = !isOpen;
            mobileMenuToggle.setAttribute('aria-expanded', String(nextState));
            mobileMenuToggle.querySelector('.hamburger')?.classList.toggle('active', nextState);
            mobileMenu.classList.toggle('active', nextState);
            document.body.style.overflow = nextState ? 'hidden' : '';
        }
        function toggleLanguageDropdown(): void {
            const isOpen = languageButton.getAttribute('aria-expanded') === 'true';
            const nextState = !isOpen;
            languageButton.setAttribute('aria-expanded', String(nextState));
            languageDropdown.classList.toggle('active', nextState);
            const arrow = languageButton.querySelector('svg:last-child') as SVGElement | null;
            if (arrow) {
                arrow.style.transform = nextState ? 'rotate(180deg)' : 'rotate(0deg)';
            }
        }
        function updateActiveNavLink(activeId: string): void {
            const currentLang = getCurrentLang();
            navLinks.forEach((link) => {
                const href = link.getAttribute('href');
                // Check both formats: /${currentLang}#${activeId} and /#${activeId}
                const isActive = href === `/${currentLang}#${activeId}` || href === `/#${activeId}`;
                if (isActive) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
            if (mobileMenu.classList.contains('active')) {
                toggleMobileMenu();
            }
        }
        function handleNavClick(this: HTMLElement, e: Event): void {
            const href = this.getAttribute('href');
            if (href) {
                // Extract section ID from href (works for both /#section and /lang#section formats)
                const hashIndex = href.indexOf('#');
                if (hashIndex !== -1) {
                    e.preventDefault();
                    const targetId = href.substring(hashIndex + 1);
                    smoothScrollTo(targetId);
                    updateActiveNavLink(targetId);
                }
            }
        }
        function handleLanguageSelect(this: HTMLElement, e: Event): void {
            e.preventDefault();
            const langCode = this.getAttribute('data-lang')!;
            const flagSvg = this.querySelector('svg')?.outerHTML ?? '';
            const langText = this.querySelector('span')?.textContent ?? '';
            document.getElementById('current-flag')!.innerHTML = flagSvg;
            document.getElementById('current-lang')!.textContent = langText;
            toggleLanguageDropdown();
            const currentPath = window.location.pathname;
            const currentHash = window.location.hash;
            // Replace language in URL path
            const newPath = currentPath.replace(/^\/(en|vi)/, `/${langCode}`);
            const finalPath = newPath.startsWith(`/${langCode}`) ? newPath : `/${langCode}${currentPath}`;
            window.location.href = finalPath + currentHash;
        }
        function handleScrollSpy(): void {
            const sections = document.querySelectorAll<HTMLElement>('section[id]');
            const scrollPos = window.scrollY + 150;
            sections.forEach((section) => {
                const top = section.offsetTop;
                const bottom = top + section.offsetHeight;
                const id = section.id;
                if (scrollPos >= top && scrollPos < bottom) {
                    updateActiveNavLink(id);
                }
            });
        }
        function handleOutsideClick(e: MouseEvent): void {
            const tgt = e.target as Node;
            if (
                mobileMenu.classList.contains('active') &&
                !mobileMenu.contains(tgt) &&
                !mobileMenuToggle.contains(tgt)
            ) {
                toggleMobileMenu();
            }
            if (
                languageDropdown.classList.contains('active') &&
                !languageDropdown.contains(tgt) &&
                !languageButton.contains(tgt)
            ) {
                toggleLanguageDropdown();
            }
        }
        function handleKeyDown(e: KeyboardEvent): void {
            if (e.key === 'Escape') {
                if (mobileMenu.classList.contains('active')) toggleMobileMenu();
                if (languageDropdown.classList.contains('active')) toggleLanguageDropdown();
            }
        }
        // Initialize current language display
        function initializeLanguageDisplay(): void {
            const currentLang = getCurrentLang();
            const activeLangOption = document.querySelector(`[data-lang="${currentLang}"]`);
            if (activeLangOption) {
                const flagSvg = activeLangOption.querySelector('svg')?.outerHTML || '';
                const langText = activeLangOption.querySelector('span')?.textContent || currentLang.toUpperCase();
                document.getElementById('current-flag')!.innerHTML = flagSvg;
                document.getElementById('current-lang')!.textContent = langText;
            }
        }
        // Event Listeners
        window.addEventListener('scroll', () => {
            updateHeaderOnScroll();
            handleScrollSpy();
        });
        mobileMenuToggle.addEventListener('click', toggleMobileMenu);
        languageButton.addEventListener('click', toggleLanguageDropdown);
        document.addEventListener('click', handleOutsideClick);
        document.addEventListener('keydown', handleKeyDown);
        navLinks.forEach((link) => {
            link.addEventListener('click', handleNavClick);
        });
        languageDropdown.querySelectorAll<HTMLElement>('[data-lang]').forEach((item) => {
            item.addEventListener('click', handleLanguageSelect);
        });
        // Initialize
        initializeLanguageDisplay();
        updateHeaderOnScroll();
        handleScrollSpy();
    });
    // Tailwind config
    window.tailwind = window.tailwind || {};
    window.tailwind.config = {
        theme: {
            extend: {
                animation: {
                    'pulse-soft': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    'fade-in-up': 'fadeInUp 0.6s ease-out',
                    'slide-down': 'slideDown 0.4s cubic-bezier(0.4, 0, 0.2, 1)',
                    'scale-in': 'scaleIn 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                    'bounce-gentle': 'bounceGentle 0.6s ease-out',
                },
                backdropBlur: {
                    xs: '2px',
                },
            },
        },
    };
</script>
<style>
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translate3d(0, 20px, 0);
        }
        to {
            opacity: 1;
            transform: translate3d(0, 0, 0);
        }
    }
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translate3d(0, -10px, 0);
        }
        to {
            opacity: 1;
            transform: translate3d(0, 0, 0);
        }
    }
    @keyframes scaleIn {
        from {
            opacity: 0;
            transform: scale(0.9);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }
    @keyframes bounceGentle {
        0%,
        20%,
        50%,
        80%,
        100% {
            transform: translateY(0);
        }
        40% {
            transform: translateY(-4px);
        }
        60% {
            transform: translateY(-2px);
        }
    }
    /* Custom scrollbar */
    ::-webkit-scrollbar {
        width: 6px;
    }
    ::-webkit-scrollbar-track {
        background: #1a1a1a;
    }
    ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #a855f7, #ec4899);
        border-radius: 3px;
    }
    ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #a855f7, #ec4899);
    }
    /* Smooth scrolling */
    html {
        scroll-behavior: smooth;
        scroll-padding-top: 100px;
    }
    /* Header backdrop effects */
    .header-backdrop {
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .header-scrolled {
        background: rgba(0, 0, 0, 0.9) !important;
        border-bottom: 1px solid;
        border-image: linear-gradient(135deg, #a855f7, #ec4899) 1;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }
    /* Mobile menu animations */
    .mobile-menu {
        position: fixed;
        top: 64px;
        left: 0;
        right: 0;
        z-index: 40;
        max-height: 0;
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
    }

    .mobile-menu.active {
        max-height: calc(100vh - 64px);
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    /* Hamburger animations */
    .hamburger-line {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        transform-origin: center;
        background: linear-gradient(135deg, #a855f7, #ec4899);
    }
    .hamburger.active .hamburger-line:nth-child(1) {
        transform: rotate(45deg) translate(6px, 6px);
    }
    .hamburger.active .hamburger-line:nth-child(2) {
        opacity: 0;
        transform: scaleX(0);
    }
    .hamburger.active .hamburger-line:nth-child(3) {
        transform: rotate(-45deg) translate(6px, -6px);
    }
    /* Language dropdown */
    .language-dropdown {
        max-height: 0;
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px) scale(0.95);
    }
    .language-dropdown.active {
        max-height: 200px;
        opacity: 1;
        visibility: visible;
        transform: translateY(0) scale(1);
    }
    /* Gradient utilities */
    .gradient-text {
        background: linear-gradient(135deg, #a855f7, #ec4899);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    .bg-gradient {
        background: linear-gradient(135deg, #a855f7, #ec4899);
    }
    .border-gradient {
        border: 1px solid;
        border-image: linear-gradient(135deg, #a855f7, #ec4899) 1;
    }
    .bg-gradient\/10 {
        background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(236, 72, 153, 0.1));
    }
    .bg-gradient\/20 {
        background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(236, 72, 153, 0.2));
    }
    .border-gradient\/20 {
        border: 1px solid;
        border-image: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(236, 72, 153, 0.2)) 1;
    }
    .border-gradient\/30 {
        border: 1px solid;
        border-image: linear-gradient(135deg, rgba(168, 85, 247, 0.3), rgba(236, 72, 153, 0.3)) 1;
    }
    /* Nav link hover effects */
    .nav-link {
        position: relative;
        overflow: hidden;
    }
    .nav-link::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(168, 85, 247, 0.15), rgba(236, 72, 153, 0.15));
        transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: -1;
    }
    .nav-link:hover::before {
        left: 0;
    }
    .nav-link:hover .nav-svg path {
        stroke: url(#shared-grad);
    }
    .nav-link:hover .nav-span {
        background: linear-gradient(135deg, #a855f7, #ec4899);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    .nav-link.active {
        background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(236, 72, 153, 0.2));
        transition: none;
    }
    /* Header z-index */
    #main-header {
        z-index: 50;
    }
</style>
